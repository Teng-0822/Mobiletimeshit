<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Profile Manager</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    button {
      padding: 10px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    .nav-btns { display: flex; justify-content: space-between; }
    .profile-info { font-size: 18px; margin: 10px 0; text-align: center; }
    .image-container {
      display: flex;
      justify-content: space-between;
      gap: 4%;
      margin: 10px 0;
    }
    .image-container img {
      width: 48%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      background: #ccc;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 10;
    }
    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 10px;
      border-radius: 10px;
      width: 95%;
      max-height: 85%;
      overflow-y: scroll;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 6px; }
    input[type="text"] {
      width: 100%;
      padding: 5px;
    }
  </style>
</head>
<body>

  <div class="nav-btns">
    <button onclick="prevProfile()">‚¨ÖÔ∏è Prev</button>
    <button onclick="nextProfile()">Next ‚û°Ô∏è</button>
  </div>

  <div class="profile-info" id="profileInfo">username > location (container)</div>

  <div style="display: flex; justify-content: center; margin: 10px 0;">
    <button onclick="openThreads()">üßµ Threads</button>
  </div>

  <textarea id="textBox" rows="4" placeholder="Your text will appear here..."></textarea>
  <button onclick="pickText()">üé≤ Pick Text</button>
  <button onclick="copyText()">üìã Copy Text</button>

  <div class="image-container">
    <img id="img1" src="">
    <img id="img2" src="">
  </div>
  <button onclick="pickImage()">üñºÔ∏è Pick Image</button>

  <button onclick="pickCaption()">üé≤ Pick Caption</button>
  <button onclick="copyCaption()">üìã Copy Caption</button>

  <button onclick="openProfileModal()">‚ûï Add Profiles</button>
  <button onclick="document.getElementById('textModal').style.display='block'">üìù Add Text Templates</button>
  <input type="file" accept="image/*" multiple onchange="uploadImages(event)">

  <!-- Add Profiles Modal -->
  <div class="modal" id="profileModal">
    <div class="modal-content">
      <h3>Paste 3 Columns √ó 60 Rows (Username, Location, Container)</h3>
      <table id="profileTable">
        <thead>
          <tr><th>Username</th><th>Location</th><th>Container ID</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="saveProfiles()">‚úÖ Save</button>
      <button onclick="document.getElementById('profileModal').style.display='none'">‚ùå Close</button>
    </div>
  </div>

  <!-- Add Text Templates Modal -->
  <div class="modal" id="textModal">
    <div class="modal-content">
      <h3>Text Templates</h3>
      <textarea id="textTemplates" rows="10" placeholder="1 template per line‚Ä¶"></textarea>
      <button onclick="saveTexts()">‚úÖ Save Texts</button>
      <button onclick="clearTexts()">üßπ Clear Texts</button>
      <button onclick="document.getElementById('textModal').style.display='none'">‚ùå Close</button>
    </div>
  </div>

<script>
let profiles = JSON.parse(localStorage.getItem("profiles") || "[]");
let texts = JSON.parse(localStorage.getItem("texts") || "[]");
let usedTexts = JSON.parse(localStorage.getItem("usedTexts") || "{}");
let usedImages = JSON.parse(localStorage.getItem("usedImages") || "{}");
let usedCaptions = JSON.parse(localStorage.getItem("usedCaptions") || "{}");
let images = JSON.parse(localStorage.getItem("images") || "[]");
let currentIndex = 0;

let captions = [
  "this light felt kinda nice", "another day, another outfit i almost didn‚Äôt wear",
  "nothing crazy, just me", "this felt like a good time to post",
  "little snapshot of life rn", "things are okay and that‚Äôs enough",
  "thought these looked kinda cute", "just going with it",
  "small things are the big things", "no big caption, just vibes",
  "in my own little world", "guess who remembered to take pics for once",
  "this week in a few photos", "not much going on but that‚Äôs fine",
  "just here, doing my best", "felt kinda peaceful",
  "no idea what i‚Äôm doing but okay", "life lately, kinda like this",
  "trying to stay present", "quiet moments and blurry photos",
  "moodboard: this", "little calm in the chaos",
  "brain = fog, photos = cute", "looked up and liked the view",
  "current setting: soft", "just a few saved memories",
  "this version of me feels good", "casually existing"
];

function updateProfile() {
  if (!profiles.length) return;
  const p = profiles[currentIndex];
  document.getElementById("profileInfo").textContent = `${p.username} > ${p.location} (${p.container})`;
  document.getElementById("textBox").value = "";
  document.getElementById("img1").src = "";
  document.getElementById("img2").src = "";
}

function nextProfile() {
  if (currentIndex < profiles.length - 1) currentIndex++;
  updateProfile();
}

function prevProfile() {
  if (currentIndex > 0) currentIndex--;
  updateProfile();
}

function copyText() {
  const txt = document.getElementById("textBox").value;
  navigator.clipboard.writeText(txt).then(() => alert("Copied!"));
}

function copyCaption() {
  const caption = captions[currentCaptionIndex] || "";
  navigator.clipboard.writeText(caption).then(() => alert("Caption copied!"));
}

let currentCaptionIndex = 0;
function pickCaption() {
  const key = currentIndex;
  const used = usedCaptions[key] || [];

  let pool = captions.filter(c => !used.includes(c));
  if (!pool.length) usedCaptions[key] = [], pool = captions;

  const pick = pool[Math.floor(Math.random() * pool.length)];
  usedCaptions[key] = [...(usedCaptions[key] || []), pick];
  localStorage.setItem("usedCaptions", JSON.stringify(usedCaptions));

  currentCaptionIndex = captions.indexOf(pick);
  alert("Caption: " + pick);
}

function pickText() {
  if (!texts.length) return alert("No texts!");
  const key = currentIndex;
  const used = usedTexts[key] || [];

  let pool = texts.filter(t => !used.includes(t));
  if (!pool.length) usedTexts[key] = [], pool = texts;

  const pick = pool[Math.floor(Math.random() * pool.length)];
  usedTexts[key] = [...(usedTexts[key] || []), pick];
  localStorage.setItem("usedTexts", JSON.stringify(usedTexts));

  const loc = profiles[currentIndex].location;
  const replaced = pick.replaceAll("(loc)", loc);
  document.getElementById("textBox").value = replaced;
}

function pickImage() {
  if (!images.length) return alert("No images!");
  const key = currentIndex;
  const used = usedImages[key] || [];

  let pool = images.map((_, i) => i).filter(i => !used.includes(i));
  if (!pool.length) usedImages[key] = [], pool = images.map((_, i) => i);

  const idx = pool[Math.floor(Math.random() * pool.length)];
  usedImages[key] = [...(usedImages[key] || []), idx];
  localStorage.setItem("usedImages", JSON.stringify(usedImages));

  const [img1, img2] = images[idx];
  document.getElementById("img1").src = img1;
  document.getElementById("img2").src = img2;
}

function openThreads() {
  const username = profiles[currentIndex]?.username;
  if (username) window.open(`https://www.threads.net/@${username}`, "_blank");
}

function uploadImages(e) {
  const files = Array.from(e.target.files);
  if (files.length % 2 !== 0) return alert("Upload images in sets of 2!");
  const readers = files.map(f => new Promise(res => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.readAsDataURL(f);
  }));
  Promise.all(readers).then(data => {
    images = [];
    for (let i = 0; i < data.length; i += 2) {
      images.push([data[i], data[i + 1]]);
    }
    localStorage.setItem("images", JSON.stringify(images));
    alert("Images saved!");
  });
}

function saveTexts() {
  texts = document.getElementById("textTemplates").value.split(/\r?\n/).filter(Boolean);
  localStorage.setItem("texts", JSON.stringify(texts));
  alert("Texts saved!");
}
function clearTexts() {
  localStorage.removeItem("texts");
  texts = [];
  document.getElementById("textTemplates").value = "";
  alert("Text templates cleared.");
}

function saveProfiles() {
  profiles = [];
  for (let i = 0; i < 60; i++) {
    const u = document.getElementById("u" + i).value;
    const l = document.getElementById("l" + i).value;
    const c = document.getElementById("c" + i).value;
    if (u && l) profiles.push({ username: u, location: l, container: c });
  }
  localStorage.setItem("profiles", JSON.stringify(profiles));
  document.getElementById("profileModal").style.display = "none";
  updateProfile();
}

function handlePaste(event) {
  event.preventDefault();
  const clipboard = (event.clipboardData || window.clipboardData).getData("text");
  const rows = clipboard.trim().split(/\r?\n/);
  for (let i = 0; i < rows.length && i < 60; i++) {
    const cols = rows[i].split(/\t|,/);
    document.getElementById("u" + i).value = cols[0] || "";
    document.getElementById("l" + i).value = cols[1] || "";
    document.getElementById("c" + i).value = cols[2] || "";
  }
}

function buildProfileTable() {
  const tbody = document.querySelector("#profileTable tbody");
  tbody.innerHTML = "";
  for (let i = 0; i < 60; i++) {
    const existing = profiles[i] || { username: "", location: "", container: "" };
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="text" id="u${i}" value="${existing.username}" onpaste="handlePaste(event)"></td>
      <td><input type="text" id="l${i}" value="${existing.location}" onpaste="handlePaste(event)"></td>
      <td><input type="text" id="c${i}" value="${existing.container}" onpaste="handlePaste(event)"></td>
    `;
    tbody.appendChild(row);
  }
}

function openProfileModal() {
  buildProfileTable();
  document.getElementById("profileModal").style.display = "block";
}

updateProfile();
</script>

</body>
</html>
